<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Profile - Oyster Personal Finance</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            overflow-x: hidden;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
        }

        /* Header */
        .header {
            position: fixed;
            top: 0;
            width: 100%;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            z-index: 1000;
            padding: 1rem 0;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 2rem;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.5rem;
            font-weight: bold;
            color: #e74c3c;
        }

        .logo img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
        }

        .nav-menu {
            display: flex;
            list-style: none;
            gap: 2rem;
        }

        .nav-menu a {
            text-decoration: none;
            color: #333;
            font-weight: 500;
            transition: all 0.3s ease;
            position: relative;
        }

        .nav-menu a:hover {
            color: #e74c3c;
            transform: translateY(-2px);
        }

        .nav-menu a::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 0;
            height: 2px;
            background: #e74c3c;
            transition: width 0.3s ease;
        }

        .nav-menu a:hover::after {
            width: 100%;
        }

        /* Mobile Navigation */
        .mobile-nav {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 1rem;
            box-shadow: 0 -2px 20px rgba(0,0,0,0.1);
            z-index: 1000;
        }

        .mobile-nav-menu {
            display: flex;
            justify-content: space-around;
            list-style: none;
        }

        .mobile-nav-menu a {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: #333;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }

        .mobile-nav-menu a:hover {
            color: #e74c3c;
            transform: translateY(-2px);
        }

        .mobile-nav-menu i {
            font-size: 1.2rem;
            margin-bottom: 0.2rem;
        }

        /* Main Content */
        .main-content {
            margin-top: 80px;
            padding: 3rem 0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        /* Login Section */
        .login-section {
            padding: 4rem 0;
            min-height: calc(100vh - 80px);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .login-container {
            max-width: 500px;
            width: 100%;
            background: white;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            overflow: hidden;
            transform: perspective(1000px) rotateX(0deg);
            transition: all 0.3s ease;
        }

        .login-container:hover {
            transform: perspective(1000px) rotateX(-2deg) translateY(-10px);
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
        }

        .login-header {
            background: linear-gradient(135deg, #1C75BC, #34495e);
            color: white;
            padding: 2rem;
            text-align: center;
        }

        .login-header h2 {
            font-size: 2rem;
            margin-bottom: 1rem;
        }

        .login-header p {
            font-size: 1.1rem;
        }

        .login-body {
            padding: 3rem;
        }

        .form-group {
            margin-bottom: 2rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
            color: #2c3e50;
        }

        .form-group input {
            width: 100%;
            padding: 1rem;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }

        .form-group input:focus {
            outline: none;
            border-color: #e74c3c;
            background: white;
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.1);
        }

        .forgot-password {
            text-align: right;
            margin-top: -1.5rem;
            margin-bottom: 2rem;
        }

        .forgot-password a {
            color: #e74c3c;
            text-decoration: none;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .forgot-password a:hover {
            text-decoration: underline;
        }

        .login-btn {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
            padding: 1rem;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
        }

        .login-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(231, 76, 60, 0.4);
        }

        .register-link {
            text-align: center;
            margin-top: 2rem;
        }

        .register-link a {
            color: #e74c3c;
            text-decoration: none;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .register-link a:hover {
            text-decoration: underline;
        }

        /* Dashboard Section */
        .dashboard-section {
            padding: 4rem 0;
            display: none;
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 3rem;
        }

        .welcome-message h1 {
            font-size: 2.5rem;
            color: #2c3e50;
            margin-bottom: 0.5rem;
        }

        .welcome-message p {
            color: #666;
        }

        .action-buttons {
            display: flex;
            gap: 1rem;
        }

        .action-btn {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
        }

        .btn-apply {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
        }

        .btn-apply:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(231, 76, 60, 0.4);
        }

        .btn-logout {
            background: #f8f9fa;
            color: #2c3e50;
            border: 2px solid #ddd;
        }

        .btn-logout:hover {
            background: #e9ecef;
            transform: translateY(-3px);
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 2rem;
        }

        .dashboard-sidebar {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            padding: 2rem;
            height: fit-content;
            transform: perspective(1000px) rotateY(0deg);
            transition: all 0.3s ease;
        }

        .dashboard-sidebar:hover {
            transform: perspective(1000px) rotateY(-2deg) translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
        }

        .user-profile {
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid #e9ecef;
        }

        .user-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            font-weight: bold;
            margin: 0 auto 1rem;
            transition: all 0.3s ease;
        }

        .user-avatar:hover {
            transform: scale(1.1) rotate(5deg);
        }

        .user-name {
            font-size: 1.5rem;
            color: #2c3e50;
            margin-bottom: 0.5rem;
        }

        .user-email {
            color: #666;
            margin-bottom: 1rem;
        }

        .edit-profile-btn {
            background: #f8f9fa;
            color: #2c3e50;
            padding: 0.5rem 1rem;
            border: 2px solid #ddd;
            border-radius: 50px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .edit-profile-btn:hover {
            background: #e9ecef;
            transform: translateY(-2px);
        }

        .dashboard-menu {
            list-style: none;
        }

        .dashboard-menu li {
            margin-bottom: 1rem;
        }

        .dashboard-menu a {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            border-radius: 10px;
            text-decoration: none;
            color: #2c3e50;
            transition: all 0.3s ease;
        }

        .dashboard-menu a:hover,
        .dashboard-menu a.active {
            background: #f8f9fa;
            color: #e74c3c;
            transform: translateX(5px);
        }

        .dashboard-menu i {
            font-size: 1.2rem;
            width: 20px;
            text-align: center;
        }

        .dashboard-content {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            padding: 2rem;
            transform: perspective(1000px) rotateY(0deg);
            transition: all 0.3s ease;
        }

        .dashboard-content:hover {
            transform: perspective(1000px) rotateY(2deg) translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
        }

        .content-title {
            font-size: 1.8rem;
            color: #2c3e50;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #e9ecef;
        }

        .dashboard-tab {
            display: none;
        }

        .dashboard-tab.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .applications-list {
            margin-bottom: 2rem;
        }

        .application-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            transition: all 0.3s ease;
            border-left: 4px solid #e74c3c;
            transform: perspective(1000px) rotateX(0deg);
        }

        .application-card:hover {
            transform: perspective(1000px) rotateX(-2deg) translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .application-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .application-title {
            font-size: 1.2rem;
            color: #2c3e50;
            font-weight: bold;
        }

        .application-status {
            padding: 0.3rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
        }

        .status-pending {
            background: #1C75BC;
            color: white;
        }

        .status-approved {
            background: #27ae60;
            color: white;
        }

        .status-rejected {
            background: #e74c3c;
            color: white;
        }

        .status-processing {
            background: #3498db;
            color: white;
        }

        .application-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .detail-item {
            display: flex;
            flex-direction: column;
        }

        .detail-label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 0.3rem;
        }

        .detail-value {
            font-weight: bold;
            color: #2c3e50;
        }

        .application-actions {
            display: flex;
            gap: 1rem;
        }

        .application-btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 5px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-view {
            background: #3498db;
            color: white;
        }

        .btn-view:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        .btn-track {
            background: #2c3e50;
            color: white;
        }

        .btn-track:hover {
            background: #1a252f;
            transform: translateY(-2px);
        }

        .no-applications {
            text-align: center;
            padding: 3rem;
            color: #666;
        }

        .no-applications i {
            font-size: 3rem;
            color: #ddd;
            margin-bottom: 1rem;
        }

        .no-applications p {
            margin-bottom: 2rem;
        }

        /* Loan Summary */
        .loan-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        .summary-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 1.5rem;
            transition: all 0.3s ease;
            border-bottom: 4px solid #e74c3c;
            transform: perspective(1000px) rotateX(0deg);
        }

        .summary-card:hover {
            transform: perspective(1000px) rotateX(-5deg) translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .summary-title {
            font-size: 1rem;
            color: #666;
            margin-bottom: 0.5rem;
        }

        .summary-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 0.5rem;
        }

        .summary-change {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
        }

        .change-positive {
            color: #27ae60;
        }

        .change-negative {
            color: #e74c3c;
        }

        /* Payment History */
        .payment-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        .payment-table th,
        .payment-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }

        .payment-table th {
            background: #f8f9fa;
            font-weight: bold;
            color: #2c3e50;
        }

        .payment-table tr:hover {
            background: #f8f9fa;
        }

        .payment-status {
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .payment-paid {
            background: #27ae60;
            color: white;
        }

        .payment-pending {
            background: #f39c12;
            color: white;
        }

        .payment-overdue {
            background: #e74c3c;
            color: white;
        }

        /* Documents */
        .documents-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1.5rem;
        }

        .document-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 1.5rem;
            text-align: center;
            transition: all 0.3s ease;
            transform: perspective(1000px) rotateX(0deg);
        }

        .document-card:hover {
            transform: perspective(1000px) rotateX(-5deg) translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .document-icon {
            font-size: 3rem;
            color: #e74c3c;
            margin-bottom: 1rem;
        }

        .document-title {
            font-size: 1.1rem;
            color: #2c3e50;
            margin-bottom: 0.5rem;
        }

        .document-date {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        .document-actions {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
        }

        .doc-btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 5px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-download {
            background: #3498db;
            color: white;
        }

        .btn-download:hover {
            background: #2980b9;
        }

        .btn-view-doc {
            background: #2c3e50;
            color: white;
        }

        .btn-view-doc:hover {
            background: #1a252f;
        }

        /* Settings */
        .settings-form {
            max-width: 600px;
        }

        .settings-section {
            margin-bottom: 3rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid #e9ecef;
        }

        .settings-title {
            font-size: 1.3rem;
            color: #2c3e50;
            margin-bottom: 1rem;
        }

        .form-row {
            display: flex;
            gap: 1rem;
        }

        .form-col {
            flex: 1;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #e74c3c;
        }

        .save-btn {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            color: white;
            padding: 0.8rem 2rem;
            border: none;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .save-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(39, 174, 96, 0.4);
        }

        /* Footer */
        .footer {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 3rem 0 1rem;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
        }

        .footer-section h3 {
            margin-bottom: 1rem;
            color: #e74c3c;
        }

        .footer-section a {
            color: white;
            text-decoration: none;
            display: block;
            margin-bottom: 0.5rem;
            transition: color 0.3s ease;
        }

        .footer-section a:hover {
            color: #e74c3c;
        }

        .footer-bottom {
            text-align: center;
            padding-top: 2rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            margin-top: 2rem;
        }

        /* Success Message */
        .success-message {
            background: #27ae60;
            color: white;
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 2rem;
            text-align: center;
            display: none;
            animation: slideInDown 0.5s ease-out;
        }

        /* Animations */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
    .nav-menu {
        display: none;
    }

    .mobile-nav {
        display: block;
    }

    .main-content {
        padding-bottom: 100px;
    }

    .dashboard-header {
        flex-direction: row;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
    }

    .welcome-message h1 {
        font-size: 1.3rem;
        margin-bottom: 0.2rem;
    }

    .welcome-message p {
        font-size: 0.9rem;
    }

    .action-buttons {
        display: flex;
        gap: 0.5rem;
    }

    .action-btn {
        padding: 0.5rem 1rem;
        font-size: 0.8rem;
        white-space: nowrap;
    }

    .dashboard-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
    }

    .dashboard-sidebar {
        order: 2;
        padding: 1rem;
    }

    .dashboard-content {
        order: 1;
        padding: 1rem;
    }

    .user-avatar {
        width: 60px;
        height: 60px;
        font-size: 1.5rem;
    }

    .user-name {
        font-size: 1rem;
    }

    .user-email {
        font-size: 0.8rem;
    }

    .dashboard-menu a {
        padding: 0.6rem;
        font-size: 0.9rem;
    }

    .loan-summary {
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
        margin-bottom: 1.5rem;
    }

    .summary-card {
        padding: 1rem;
    }

    .summary-value {
        font-size: 1.3rem;
    }

    .application-card {
        padding: 1rem;
        margin-bottom: 1rem;
    }

    .application-details {
        grid-template-columns: repeat(2, 1fr);
        gap: 0.8rem;
    }

    .application-actions {
        flex-direction: row;
        gap: 0.5rem;
    }

    .application-btn {
        padding: 0.4rem 0.8rem;
        font-size: 0.8rem;
        flex: 1;
    }

    .tracking-step {
        width: 50px;
    }

    .step-icon {
        width: 35px;
        height: 35px;
        font-size: 0.9rem;
    }

    .step-label {
        font-size: 0.7rem;
    }

    .tracking-message {
        font-size: 0.9rem;
        padding: 1rem;
    }

    .application-tracking {
        margin-bottom: 1.5rem;
        padding: 1.5rem;
    }

    .tracking-title {
        font-size: 1.3rem;
        margin-bottom: 1rem;
    }
}

        /* Application Tracking Styles */
        .application-tracking {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transform: perspective(1000px) rotateX(0deg);
            transition: all 0.3s ease;
        }

        .application-tracking:hover {
            transform: perspective(1000px) rotateX(-2deg) translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
        }

        .tracking-title {
            font-size: 1.8rem;
            color: #2c3e50;
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .tracking-container {
            position: relative;
        }

        .tracking-progress-bar {
            height: 8px;
            background: #f1f1f1;
            border-radius: 4px;
            margin-bottom: 2rem;
            position: relative;
            z-index: 1;
        }

        .tracking-progress {
            height: 100%;
            background: linear-gradient(90deg, #e74c3c, #27ae60);
            border-radius: 4px;
            width: 0%;
            transition: width 1s ease;
            position: relative;
        }

        .tracking-progress::after {
            content: '';
            position: absolute;
            right: -10px;
            top: -6px;
            width: 20px;
            height: 20px;
            background: #27ae60;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .tracking-steps {
            display: flex;
            justify-content: space-between;
            margin-bottom: 2rem;
            position: relative;
        }

        .tracking-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 80px;
            text-align: center;
            position: relative;
            z-index: 2;
        }

        .step-icon {
            width: 50px;
            height: 50px;
            background: #f1f1f1;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 0.5rem;
            color: #666;
            font-size: 1.2rem;
            transition: all 0.5s ease;
        }

        .step-label {
            font-size: 0.9rem;
            color: #666;
            transition: all 0.5s ease;
        }

        .tracking-step.active .step-icon {
            background: #e74c3c;
            color: white;
            transform: scale(1.2);
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.3);
        }

        .tracking-step.active .step-label {
            color: #e74c3c;
            font-weight: bold;
        }

        .tracking-step.completed .step-icon {
            background: #27ae60;
            color: white;
        }

        .tracking-step.completed .step-label {
            color: #27ae60;
        }

        .tracking-message {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 10px;
            margin-bottom: 1.5rem;
            text-align: center;
            font-size: 1.1rem;
            border-left: 4px solid #e74c3c;
            transition: all 0.5s ease;
        }

        .tracking-actions {
            text-align: center;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(39, 174, 96, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(39, 174, 96, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(39, 174, 96, 0);
            }
        }

        /* Security Info */
        .security-info {
            margin-top: 2rem;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 10px;
            text-align: center;
            font-size: 0.9rem;
            color: #666;
        }

        .security-info i {
            font-size: 1.5rem;
            color: #27ae60;
            margin-bottom: 0.5rem;
        }

        .last-login {
            margin-top: 0.5rem;
            font-size: 0.8rem;
        }

        .security-note {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 10px;
            margin: 1rem 0;
            font-size: 0.9rem;
            color: #666;
            display: flex;
            align-items: center;
        }

        .security-note i {
            font-size: 1.2rem;
            color: #27ae60;
            margin-right: 0.5rem;
        }

        /* Add Payment Section */
        .add-payment-section {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 10px;
            margin-bottom: 2rem;
        }

        .add-payment-section h3 {
            margin-bottom: 1rem;
            font-size: 1.3rem;
            color: #2c3e50;
        }

        .add-payment-btn {
            margin-top: 1.9rem;
        }

        .no-payments-message {
            text-align: center;
            padding: 2rem;
            color: #666;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 9999;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.7);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: #fff;
            margin: 5% auto;
            padding: 2rem;
            border-radius: 15px;
            width: 80%;
            max-width: 800px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.3);
            animation: modalFadeIn 0.5s;
            max-height: 90vh;
            overflow-y: auto;
        }

        .close-modal {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .close-modal:hover {
            color: #e74c3c;
        }

        .modal-actions {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 2rem;
        }

        @keyframes modalFadeIn {
            from {opacity: 0; transform: translateY(-50px);}
            to {opacity: 1; transform: translateY(0);}
        }

        /* Approval Letter Styles */
        .approval-letter {
            background: white;
            padding: 2rem;
            border: 1px solid #ddd;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .letter-header {
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #e74c3c;
        }

        .letter-logo {
            margin-bottom: 1rem;
        }

        .letter-header h2 {
            color: #e74c3c;
            margin-bottom: 1rem;
        }

        .letter-date, .letter-ref {
            color: #666;
            margin-bottom: 0.5rem;
        }

        .letter-body {
            padding: 0 1rem;
        }

        .letter-greeting {
            margin-bottom: 1.5rem;
        }

        .letter-details {
            margin: 1.5rem 0;
        }

        .letter-details table {
            width: 100%;
            border-collapse: collapse;
        }

        .letter-details td {
            padding: 0.5rem;
            border-bottom: 1px solid #eee;
        }

        .letter-details td:first-child {
            font-weight: bold;
            width: 40%;
        }

        .letter-note {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 10px;
            margin: 1.5rem 0;
            border-left: 4px solid #f39c12;
        }

        .letter-note ul {
            margin: 1rem 0 1rem 1.5rem;
        }

        .letter-note li {
            margin-bottom: 0.5rem;
        }

        .letter-closing {
            margin: 1.5rem 0;
        }

        .letter-signature {
            margin-top: 3rem;
            text-align: right;
        }

        .signature-img {
            margin-bottom: 0.5rem;
        }

        .letter-footer {
            margin-top: 3rem;
            padding-top: 1rem;
            border-top: 1px solid #ddd;
            text-align: center;
            font-size: 0.8rem;
            color: #666;
        }

        /* Active Loans List */
        .active-loans-list {
            margin-top: 2rem;
        }

        .no-loans-message {
            text-align: center;
            padding: 3rem;
            background: #f8f9fa;
            border-radius: 10px;
            color: #666;
        }

        .no-loans-message i {
            font-size: 3rem;
            color: #ddd;
            margin-bottom: 1rem;
        }
    }

    .tracking-message {
    background: #f8f9fa;
    padding: 1.5rem;
    border-radius: 10px;
    margin-bottom: 1.5rem;
    text-align: center;
    font-size: 1.1rem;
    border-left: 4px solid #e74c3c;
    transition: all 0.5s ease;
    line-height: 1.6;
}

.tracking-message small {
    display: block;
    margin-top: 0.5rem;
    font-size: 0.9rem;
    color: #e74c3c !important;
    font-weight: bold;
}

        /* Advanced Progress Bar */
        .progress-container {
            position: relative;
            margin-bottom: 2rem;
        }
        
        .progress-bar-advanced {
            height: 10px;
            background: #f1f1f1;
            border-radius: 5px;
            overflow: hidden;
            position: relative;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #e74c3c, #27ae60);
            border-radius: 5px;
            width: 0%;
            transition: width 1.5s cubic-bezier(0.65, 0, 0.35, 1);
            position: relative;
        }
        
        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(
                90deg,
                rgba(255, 255, 255, 0.15) 25%,
                transparent 25%,
                transparent 50%,
                rgba(255, 255, 255, 0.15) 50%,
                rgba(255, 255, 255, 0.15) 75%,
                transparent 75%
            );
            background-size: 20px 20px;
            animation: progress-animation 1s linear infinite;
        }
        
        .progress-percentage {
            position: absolute;
            top: -25px;
            right: 0;
            background: #e74c3c;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.8rem;
            font-weight: bold;
            transform: translateX(50%);
            transition: right 1.5s cubic-bezier(0.65, 0, 0.35, 1);
        }
        
        @keyframes progress-animation {
            0% {
                background-position: 0 0;
            }
            100% {
                background-position: 20px 0;
            }
        }
        
        /* Counting Animation */
        .counting-animation {
            display: inline-block;
            transition: all 0.3s ease;
        }
        
        /* Enhanced Mobile Styles */
        @media (max-width: 768px) {
            .login-container {
                width: 90%;
                max-width: 400px;
            }
            
            .login-header h2 {
                font-size: 1.5rem;
            }
            
            .login-header p {
                font-size: 0.9rem;
            }
            
            .login-body {
                padding: 1.5rem;
            }
            
            .form-group input {
                padding: 0.8rem;
            }
            
            .dashboard-header h1 {
                font-size: 1.8rem;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .summary-card {
                padding: 1rem;
            }
            
            .summary-value {
                font-size: 1.5rem;
            }
            
            .application-card {
                padding: 1rem;
            }
            
            .tracking-step {
                width: 60px;
            }
            
            .step-icon {
                width: 40px;
                height: 40px;
                font-size: 1rem;
            }
            
            .step-label {
                font-size: 0.7rem;
            }
            
            .tracking-message {
                font-size: 0.9rem;
                padding: 1rem;
            }
            
            .user-avatar {
                width: 80px;
                height: 80px;
                font-size: 2rem;
            }
            
            .user-name {
                font-size: 1.3rem;
            }
            
            .dashboard-menu a {
                padding: 0.8rem;
            }
            
            .content-title {
                font-size: 1.5rem;
            }
            
            .application-title {
                font-size: 1rem;
            }
            
            .detail-label {
                font-size: 0.8rem;
            }
            
            .detail-value {
                font-size: 0.9rem;
            }
            
            .application-btn {
                padding: 0.4rem 0.8rem;
                font-size: 0.8rem;
            }
            
            .modal-content {
                width: 95%;
                padding: 1rem;
            }
            
            .letter-header h2 {
                font-size: 1.3rem;
            }
        }

    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <nav class="nav-container">
            <div class="logo">
                <img src="image/ChatGPT_Image_Jun_5__2025__12_04_34_AM-removebg-preview.png?height=50&width=50" alt="Oyster Personal Finance Logo">
                <span></span>
            </div>
            <ul class="nav-menu">
                <li><a href="index.html">Home</a></li>
                <li><a href="about.html">About</a></li>
                <li><a href="apply.html">Apply</a></li>
                <li><a href="review.html">Reviews</a></li>
                <li><a href="contact.html">Contact</a></li>
                <li><a href="profile.html">Profile</a></li>
            </ul>
        </nav>
    </header>

     <!-- Mobile Navigation -->
    <nav class="mobile-nav">
        <ul class="mobile-nav-menu">
            <li><a href="index.html"><i class="fas fa-home"></i>Home</a></li>
            <li><a href="about.html"><i class="fas fa-info-circle"></i>About</a></li>
            <li><a href="apply.html"><i class="fas fa-file-alt"></i>Apply</a></li>
            <li><a href="review.html"><i class="fas fa-star"></i>Reviews</a></li>
            <li><a href="contact.html"><i class="fas fa-phone"></i>Contact</a></li>
            <li><a href="profile.html"><i class="fas fa-user"></i>Profile</a></li>
        </ul>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Login Section -->
        <section class="login-section" id="loginSection">
    <div class="container">
        <div class="login-container">
            <div class="login-header">
                <h2>Welcome Back</h2>
                <p>Sign in to access your account and track your loan applications</p>
            </div>
            <div class="login-body">
                <!-- Login Form -->
                <form id="loginForm" style="display: block;">
                    <div class="form-group">
                        <label for="email">Email Address</label>
                        <input type="email" id="email" name="email" placeholder="Enter your email" required>
                    </div>
                    <div class="form-group" id="pinInputGroup" style="display: none;">
                        <label for="pin">PIN</label>
                        <input type="password" id="pin" name="pin" placeholder="Enter your PIN" maxlength="4" pattern="[0-9]*" inputmode="numeric">
                        <p class="form-note">Enter your 4-digit PIN to access your account.</p>
                    </div>
                    <div class="forgot-password" id="forgotPinSection" style="display: none;">
                        <a href="#" id="forgotPasswordLink">Forgot PIN?</a>
                    </div>
                    <button type="submit" class="login-btn" id="loginButton">
                        <i class="fas fa-arrow-right"></i> Continue
                    </button>
                    <button type="button" class="login-btn" id="backButton" style="display: none; margin-top: 10px; background: #f8f9fa; color: #333;">
                        <i class="fas fa-arrow-left"></i> Back
                    </button>
                </form>

                <!-- PIN Creation Form (initially hidden) -->
                <form id="createPinForm" style="display: none;">
                    <div class="form-group">
                        <label for="newPin">Create a 4-Digit PIN</label>
                        <input type="password" id="newPin" name="newPin" placeholder="Enter 4-digit PIN" maxlength="4" pattern="[0-9]*" inputmode="numeric" required>
                    </div>
                    <div class="form-group">
                        <label for="confirmPin">Confirm PIN</label>
                        <input type="password" id="confirmPin" name="confirmPin" placeholder="Confirm your PIN" maxlength="4" pattern="[0-9]*" inputmode="numeric" required>
                    </div>
                    <p class="form-note">This PIN will be used for future logins along with your email.</p>
                    <button type="submit" class="login-btn">
                        <i class="fas fa-lock"></i> Create PIN
                    </button>
                </form>

                <div class="register-link">
                    <p>Don't have an account? <a href="apply.html">Apply for a loan to create one</a></p>
                </div>
            </div>
        </div>
    </div>
</section>

        <!-- Dashboard Section -->
        <section class="dashboard-section" id="dashboardSection">
    <div class="container">
        <div class="dashboard-header">
            <div class="welcome-message">
                <h1>Welcome back, <span id="userName">John</span>!</h1>
                <p>Here's an overview of your loan applications and account.</p>
            </div>
            <div class="action-buttons">
                <a href="apply.html" class="action-btn btn-apply" id="applyNewLoanBtn">
                    <i class="fas fa-plus"></i> New Application
                </a>
                <button id="logoutBtn" class="action-btn btn-logout">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </div>

        <!-- Application Tracking Section -->
        <div class="application-tracking" id="applicationTrackingSection">
            <h2 class="tracking-title">Application Progress</h2>
            <div class="progress-container">
                    <div class="progress-bar-advanced">
                        <div class="progress-fill" id="trackingProgressBar"></div>
                    </div>
                    <div class="progress-percentage" id="progressPercentage">0%</div>
                </div>
            <div class="tracking-container">
                
                <div class="tracking-steps">
                    <div class="tracking-step active" data-step="1">
                        <div class="step-icon"><i class="fas fa-file-alt"></i></div>
                        <div class="step-label">Submitted</div>
                    </div>
                    <div class="tracking-step" data-step="2">
                        <div class="step-icon"><i class="fas fa-search"></i></div>
                        <div class="step-label">Processing</div>
                    </div>
                    <div class="tracking-step" data-step="3">
                        <div class="step-icon"><i class="fas fa-check-circle"></i></div>
                        <div class="step-label">Qualified</div>
                    </div>
                    <div class="tracking-step" data-step="4">
                        <div class="step-icon"><i class="fas fa-flag"></i></div>
                        <div class="step-label">Review</div>
                    </div>
                    <div class="tracking-step" data-step="5">
                        <div class="step-icon"><i class="fas fa-file-signature"></i></div>
                        <div class="step-label">Approved</div>
                    </div>
                </div>
                <div class="tracking-message" id="trackingMessage">
                    Your application has been submitted and is now being processed. We'll update you shortly.
                </div>
                <div class="tracking-actions" id="trackingActions" style="display: none;">
                    <button id="viewApprovalLetterBtn" class="btn btn-primary" onclick="viewApprovalLetter()">
    <i class="fas fa-file-pdf"></i> View Approval Letter
</button>
                </div>
            </div>
        </div>

        <div class="dashboard-grid">
            <div class="dashboard-sidebar">
                <div class="user-profile">
                    <div class="user-avatar" id="userAvatar">JD</div>
                    <h3 class="user-name" id="userFullName">John Doe</h3>
                    <p class="user-email" id="userEmail">john.doe@example.com</p>
                    <button class="edit-profile-btn" data-tab="settings">Edit Profile</button>
                </div>
                <ul class="dashboard-menu">
                    <li>
                        <a href="#" class="active" data-tab="applications">
                            <i class="fas fa-file-alt"></i> My Applications
                        </a>
                    </li>
                    <li>
                        <a href="#" data-tab="loans">
                            <i class="fas fa-money-bill-wave"></i> Active Loans
                        </a>
                    </li>
                    <li>
                        <a href="#" data-tab="payments">
                            <i class="fas fa-credit-card"></i> Payment History
                        </a>
                    </li>
                    <li>
                        <a href="#" data-tab="documents">
                            <i class="fas fa-folder"></i> Documents
                        </a>
                    </li>
                    <li>
                        <a href="#" data-tab="settings">
                            <i class="fas fa-cog"></i> Account Settings
                        </a>
                    </li>
                </ul>
                <div class="security-info">
                    <i class="fas fa-shield-alt"></i>
                    <p>All your data is encrypted and secure</p>
                    <p class="last-login">Last login: <span id="lastLoginTime">Today, 10:45 AM</span></p>
                </div>
            </div>
            <div class="dashboard-content">
                <!-- Applications Tab -->
                <div class="dashboard-tab active" id="applicationsTab">
                    <h2 class="content-title">My Applications</h2>
                    <div class="loan-summary">
                        <div class="summary-card">
                            <div class="summary-title">Total Applications</div>
                            <div class="summary-value" id="totalApplications">0</div>
                            <div class="summary-change change-positive">
                                <i class="fas fa-arrow-up"></i> <span id="newApplications">0</span> new this month
                            </div>
                        </div>
                        <div class="summary-card">
                            <div class="summary-title">Approved Applications</div>
                            <div class="summary-value" id="approvedApplications">0</div>
                            <div class="summary-change change-positive">
                                <i class="fas fa-check-circle"></i> <span id="approvalRate">0</span>% approval rate
                            </div>
                        </div>
                        <div class="summary-card">
                            <div class="summary-title">Pending Applications</div>
                            <div class="summary-value" id="pendingApplications">0</div>
                            <div class="summary-change">
                                <i class="fas fa-clock"></i> Expected response: 24h
                            </div>
                        </div>
                    </div>
                    <div class="applications-list" id="applicationsList">
                        <!-- Applications will be loaded here -->
                    </div>
                </div>

                <!-- Active Loans Tab -->
                <div class="dashboard-tab" id="loansTab">
                    <h2 class="content-title">Active Loans</h2>
                    <div class="loan-summary">
                        <div class="summary-card">
                            <div class="summary-title">Total Loan Amount</div>
                            <div class="summary-value" id="totalLoanAmount">R0</div>
                            <div class="summary-change">
                                <i class="fas fa-info-circle"></i> <span id="activeLoanCount">0</span> active loans
                            </div>
                        </div>
                        <div class="summary-card">
                            <div class="summary-title">Monthly Payment</div>
                            <div class="summary-value" id="monthlyPayment">R0</div>
                            <div class="summary-change change-positive">
                                <i class="fas fa-calendar-check"></i> Next payment: <span id="nextPaymentDate">N/A</span>
                            </div>
                        </div>
                        <div class="summary-card">
                            <div class="summary-title">Outstanding Balance</div>
                            <div class="summary-value" id="outstandingBalance">R0</div>
                            <div class="summary-change" id="paidOffPercentage">
                                <i class="fas fa-arrow-down"></i> 0% paid off
                            </div>
                        </div>
                    </div>
                    <div class="active-loans-list" id="activeLoanslist">
                        <!-- Active loans will be loaded here -->
                        <div class="no-loans-message" id="noLoansMessage">
                            <i class="fas fa-info-circle"></i>
                            <p>You don't have any active loans at the moment.</p>
                        </div>
                    </div>
                </div>

                <!-- Payment History Tab -->
                <div class="dashboard-tab" id="paymentsTab">
                    <h2 class="content-title">Payment History</h2>
                    <div class="add-payment-section">
                        <h3>Add Payment Due Date</h3>
                        <form id="addPaymentForm">
                            <div class="form-row">
                                <div class="form-col">
                                    <div class="form-group">
                                        <label for="paymentLoan">Loan</label>
                                        <select id="paymentLoan" required>
                                            <option value="">Select loan</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-col">
                                    <div class="form-group">
                                        <label for="paymentAmount">Amount (R)</label>
                                        <input type="number" id="paymentAmount" required min="1">
                                    </div>
                                </div>
                                <div class="form-col">
                                    <div class="form-group">
                                        <label for="paymentDate">Due Date</label>
                                        <input type="date" id="paymentDate" required>
                                    </div>
                                </div>
                                <div class="form-col">
                                    <button type="submit" class="btn btn-primary add-payment-btn">
                                        <i class="fas fa-plus"></i> Add
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                    <table class="payment-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Loan Type</th>
                                <th>Amount</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="paymentsTableBody">
                            <!-- Payments will be loaded here -->
                            <tr class="no-payments-row">
                                <td colspan="5" class="no-payments-message">No payment records found. Add your payment due dates above.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Documents Tab -->
                <div class="dashboard-tab" id="documentsTab">
                    <h2 class="content-title">My Documents</h2>
                    <div class="documents-grid" id="documentsGrid">
                        <!-- Documents will be loaded here -->
                    </div>
                </div>

                <!-- Settings Tab -->
                <div class="dashboard-tab" id="settingsTab">
                    <h2 class="content-title">Account Settings</h2>
                    <div class="success-message" id="settingsSuccessMessage">
                        <i class="fas fa-check-circle"></i> Your settings have been updated successfully!
                    </div>
                    <form class="settings-form" id="settingsForm">
                        <div class="settings-section">
                            <h3 class="settings-title">Personal Information</h3>
                            <div class="form-row">
                                <div class="form-col">
                                    <div class="form-group">
                                        <label for="settingsFirstName">First Name</label>
                                        <input type="text" id="settingsFirstName" name="firstName" value="John">
                                    </div>
                                </div>
                                <div class="form-col">
                                    <div class="form-group">
                                        <label for="settingsLastName">Last Name</label>
                                        <input type="text" id="settingsLastName" name="lastName" value="Doe">
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="settingsEmail">Email Address</label>
                                <input type="email" id="settingsEmail" name="email" value="john.doe@example.com" readonly>
                                <p class="form-note">Email address cannot be changed as it's linked to your applications.</p>
                            </div>
                            <div class="form-group">
                                <label for="settingsPhone">Phone Number</label>
                                <input type="tel" id="settingsPhone" name="phone" value="071 234 5678">
                            </div>
                        </div>
                        <div class="settings-section">
                            <h3 class="settings-title">Security Settings</h3>
                            <div class="form-group">
                                <label for="currentPin">Current PIN</label>
                                <input type="password" id="currentPin" name="currentPin" placeholder="Enter current PIN" maxlength="4" pattern="[0-9]*" inputmode="numeric">
                            </div>
                            <div class="form-row">
                                <div class="form-col">
                                    <div class="form-group">
                                        <label for="newPin">New PIN</label>
                                        <input type="password" id="newPin" name="newPin" placeholder="Enter new PIN" maxlength="4" pattern="[0-9]*" inputmode="numeric">
                                    </div>
                                </div>
                                <div class="form-col">
                                    <div class="form-group">
                                        <label for="confirmNewPin">Confirm New PIN</label>
                                        <input type="password" id="confirmNewPin" name="confirmNewPin" placeholder="Confirm new PIN" maxlength="4" pattern="[0-9]*" inputmode="numeric">
                                    </div>
                                </div>
                            </div>
                            <p class="security-note">
                                <i class="fas fa-shield-alt"></i> All changes are encrypted and securely stored. We recommend changing your PIN periodically.
                            </p>
                        </div>
                        <button type="submit" class="save-btn">
                            <i class="fas fa-save"></i> Save Changes
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</section>

<div class="modal" id="approvalLetterModal">
    <div class="modal-content">
        <span class="close-modal">&times;</span>
        <div class="approval-letter">
            <div class="letter-header">
                <img src="/placeholder.svg?height=80&width=200" alt="Oyster Finance Logo" class="letter-logo">
                <h2>LOAN APPROVAL LETTER</h2>
                <p class="letter-date" id="letterDate">Date: June 3, 2025</p>
                <p class="letter-ref" id="letterRef">Ref: OPF-12345</p>
            </div>
            <div class="letter-body">
                <p class="letter-greeting">Dear <span id="letterName">John Doe</span>,</p>
                <p>We are pleased to inform you that your loan application has been <strong>APPROVED</strong>.</p>
                <div class="letter-details">
                    <table>
                        <tr>
                            <td>Loan Type:</td>
                            <td id="letterLoanType">Personal Loan</td>
                        </tr>
                        <tr>
                            <td>Loan Amount:</td>
                            <td id="letterLoanAmount">R50,000</td>
                        </tr>
                        <tr>
                            <td>Interest Rate:</td>
                            <td id="letterInterestRate">3% per annum</td>
                        </tr>
                        <tr>
                            <td>Loan Term:</td>
                            <td id="letterLoanTerm">36 months</td>
                        </tr>
                        <tr>
                            <td>Monthly Repayment:</td>
                            <td id="letterMonthlyPayment">R1,450</td>
                        </tr>
                        <tr>
                            <td>First Payment Due:</td>
                            <td id="letterFirstPayment">July 15, 2025</td>
                        </tr>
                    </table>
                </div>
                <div class="letter-note">
                    <p><strong>Note:</strong> Your application has been flagged for a low credit issue. However, we have approved your loan with the following conditions:</p>
                    <ul>
                        <li>Timely repayment of all installments</li>
                        <li>No missed payments for the first 6 months</li>
                        <li>Maintaining minimum balance in your account</li>
                    </ul>
                    <p>Please contact our customer service team if you have any questions or concerns.</p>
                </div>
                <p class="letter-closing">Congratulations on your loan approval!</p>
                <div class="letter-signature">
                    <img src="/placeholder.svg?height=60&width=150" alt="Signature" class="signature-img">
                    <p>John Smith</p>
                    <p>Loan Officer</p>
                    <p>Oyster Personal Finance</p>
                </div>
            </div>
            <div class="letter-footer">
                <p>Oyster Personal Finance | 123 Finance Street, Johannesburg | Tel: +27 12 345 6789 | NCRCP11356</p>
            </div>
        </div>
        <div class="modal-actions">
            <button class="btn btn-primary" id="downloadLetterBtn">
                <i class="fas fa-download"></i> Download PDF
            </button>
            <button class="btn btn-secondary close-modal-btn">
                <i class="fas fa-times"></i> Close
            </button>
        </div>
    </div>
</div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>Oyster Personal Finance</h3>
                <p>NCRCP11356</p>
                <p>Based in South Africa</p>
                <p>Empowering financial freedom through innovative lending solutions.</p>
            </div>
            <div class="footer-section">
                <h3>Quick Links</h3>
                <a href="index.html">Home</a>
                <a href="about.html">About</a>
                <a href="apply.html">Apply</a>
                <a href="review.html">Reviews</a>
                <a href="contact.html">Contact</a>
                <a href="profile.html">Profile</a>
            </div>
            <div class="footer-section">
                    <li><a href="#"><i class="fas fa-map-marker-alt"></i> 20 Georgian Crescent Bryanston, Johannesburg, South Africa</a></li>
                    <li><a href="tel:+27698480097"><i class="fas fa-phone"></i> +27 69 848 0097</a></li>
                    <li><a href="mailto:apply@oysterpersonalfinance.com"><i class="fas fa-envelope"></i> apply@oysterpersonalfinance.com</a></li>
                    <li><a href="#"><i class="fas fa-clock"></i> Mon-Fri: 8:00 AM - 5:00 PM</a></li>>
            </div>
            <div class="footer-section">
                <h3>Legal</h3>
                <a href="#">Terms & Conditions</a>
                <a href="#">Privacy Policy</a>
                <a href="#">Responsible Lending</a>
                <a href="#">Complaints Procedure</a>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 Oyster Personal Finance. All Rights Reserved. NCRCP11356</p>
        </div>
    </footer>

    <script>
// Baserow API configuration
const BASEROW_API_URL = 'https://api.baserow.io/api/database/rows/table/';
const BASEROW_API_KEY = 'LG6hnTBxgBG78FueElsSwpHRd4Wep1oL';
const BASEROW_TABLE_ID = '561419';
const BASEROW_EMAIL_FIELD_ID = '4502368';

// Check if user is already logged in
window.addEventListener('load', function() {
    const isLoggedIn = localStorage.getItem('isLoggedIn');
    const userEmail = localStorage.getItem('userEmail');
    
    if (isLoggedIn === 'true' && userEmail) {
        showDashboard();
        loadUserData();
        fetchUserApplicationsFromBaserow(userEmail);
        
        // Set last login time
        const lastLogin = localStorage.getItem('lastLoginTime') || new Date().toISOString();
        document.getElementById('lastLoginTime').textContent = formatDate(new Date(lastLogin));
        localStorage.setItem('lastLoginTime', new Date().toISOString());
        
        // Start real application tracking if there are pending applications
        const applications = JSON.parse(localStorage.getItem('loanApplications') || '[]');
        const pendingApplications = applications.filter(app => app.status === 'Pending');
        
        if (pendingApplications.length > 0) {
            startRealApplicationTracking(pendingApplications[0]);
        } else {
            document.getElementById('applicationTrackingSection').style.display = 'none';
        }
    }
});

// Update the checkEmailInBaserow function to use the specific field ID
async function checkEmailInBaserow(email) {
    try {
        const response = await fetch(`${BASEROW_API_URL}${BASEROW_TABLE_ID}/?user_field_names=true`, {
            method: 'GET',
            headers: {
                'Authorization': `Token ${BASEROW_API_KEY}`
            }
        });
        
        if (!response.ok) {
            throw new Error(`API Error: ${response.status}`);
        }
        
        const data = await response.json();
        
        // Check if any record has the matching email in the Email field (ID: 4502368)
        return data.results.some(result => {
            return result.Email && result.Email.toLowerCase().trim() === email.toLowerCase().trim();
        });
        
    } catch (error) {
        console.error('Error checking email in Baserow:', error);
        return false;
    }
}

// Login form submission - Step 1: Email verification
document.getElementById('loginForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const email = document.getElementById('email').value.trim();
    const pinInputGroup = document.getElementById('pinInputGroup');
    const forgotPinSection = document.getElementById('forgotPinSection');
    const loginButton = document.getElementById('loginButton');
    const backButton = document.getElementById('backButton');
    
    // If PIN field is visible, this is step 2
    if (pinInputGroup.style.display === 'block') {
        const pin = document.getElementById('pin').value.trim();
        
        if (!pin) {
            alert('Please enter your PIN.');
            return;
        }
        
        // Show loading state
        const originalBtnText = loginButton.innerHTML;
        loginButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Verifying...';
        loginButton.disabled = true;
        
        try {
            // Verify PIN
            const savedPin = localStorage.getItem(`pin_${email}`);
            
            if (pin !== savedPin) {
                alert('Incorrect PIN. Please try again.');
                document.getElementById('pin').value = '';
                document.getElementById('pin').focus();
                loginButton.innerHTML = originalBtnText;
                loginButton.disabled = false;
                return;
            }
            
            // Login successful
            localStorage.setItem('isLoggedIn', 'true');
            localStorage.setItem('lastLoginTime', new Date().toISOString());
            
            // Fetch user data from Baserow
            await fetchUserApplicationsFromBaserow(email);
            
            showDashboard();
            loadUserData();
            
            // Start real application tracking if there are pending applications
            const applications = JSON.parse(localStorage.getItem('loanApplications') || '[]');
            const pendingApplications = applications.filter(app => app.status === 'Pending');
            
            if (pendingApplications.length > 0) {
                startRealApplicationTracking(pendingApplications[0]);
            } else {
                document.getElementById('applicationTrackingSection').style.display = 'none';
            }
            
        } catch (error) {
            console.error('Login error:', error);
            alert('An error occurred during login. Please try again.');
            loginButton.innerHTML = originalBtnText;
            loginButton.disabled = false;
        }
        
        return;
    }
    
    // This is step 1: Email verification
    if (!email) {
        alert('Please enter your email address.');
        return;
    }
    
    // Always save email on device first
    localStorage.setItem('userEmail', email);
    
    // Show loading state
    const originalBtnText = loginButton.innerHTML;
    loginButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Verifying...';
    loginButton.disabled = true;
    
    try {
        // Check if email exists in Baserow using specific field ID
        const userExists = await checkEmailInBaserow(email);
        
        if (!userExists) {
            alert('No applications found with this email address. Please apply for a loan first.');
            loginButton.innerHTML = originalBtnText;
            loginButton.disabled = false;
            return;
        }
        
        // Check if user has a PIN set
        const savedPin = localStorage.getItem(`pin_${email}`);
        
        if (!savedPin) {
            // First time login - show PIN creation form
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('createPinForm').style.display = 'block';
            
            // Store email temporarily for PIN creation
            sessionStorage.setItem('tempEmail', email);
            
            loginButton.innerHTML = originalBtnText;
            loginButton.disabled = false;
            return;
        }
        
        // Show PIN input for returning user
        document.getElementById('email').readOnly = true;
        pinInputGroup.style.display = 'block';
        forgotPinSection.style.display = 'block';
        loginButton.innerHTML = '<i class="fas fa-sign-in-alt"></i> Sign In';
        backButton.style.display = 'block';
        document.getElementById('pin').focus();
        
        loginButton.innerHTML = originalBtnText;
        loginButton.disabled = false;
        
    } catch (error) {
        console.error('Login error:', error);
        alert('An error occurred during login. Please try again.');
        loginButton.innerHTML = originalBtnText;
        loginButton.disabled = false;
    }
});

// Back button handler
document.getElementById('backButton').addEventListener('click', function() {
    document.getElementById('email').readOnly = false;
    document.getElementById('pinInputGroup').style.display = 'none';
    document.getElementById('forgotPinSection').style.display = 'none';
    document.getElementById('loginButton').innerHTML = '<i class="fas fa-arrow-right"></i> Continue';
    this.style.display = 'none';
});

// PIN Creation Form
document.getElementById('createPinForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const newPin = document.getElementById('newPin').value;
    const confirmPin = document.getElementById('confirmPin').value;
    const email = sessionStorage.getItem('tempEmail');
    
    if (newPin !== confirmPin) {
        alert('PINs do not match. Please try again.');
        return;
    }
    
    if (newPin.length !== 4 || !/^\d+$/.test(newPin)) {
        alert('PIN must be exactly 4 digits.');
        return;
    }
    
    // Save PIN
    localStorage.setItem(`pin_${email}`, newPin);
    
    // Clear session storage
    sessionStorage.removeItem('tempEmail');
    
    // Login successful
    localStorage.setItem('isLoggedIn', 'true');
    localStorage.setItem('lastLoginTime', new Date().toISOString());
    
    // Fetch user data and show dashboard
    fetchUserApplicationsFromBaserow(email).then(() => {
        showDashboard();
        loadUserData();
        
        // Start real application tracking if there are pending applications
        const applications = JSON.parse(localStorage.getItem('loanApplications') || '[]');
        const pendingApplications = applications.filter(app => app.status === 'Pending');
        
        if (pendingApplications.length > 0) {
            startRealApplicationTracking(pendingApplications[0]);
        } else {
            document.getElementById('applicationTrackingSection').style.display = 'none';
        }
    });
});

// Show dashboard function
function showDashboard() {
    document.getElementById('loginSection').style.display = 'none';
    document.getElementById('dashboardSection').style.display = 'block';
}

// Load user data function
function loadUserData() {
    const applications = JSON.parse(localStorage.getItem('loanApplications') || '[]');
    const userEmail = localStorage.getItem('userEmail');
    
    if (applications.length > 0) {
        const firstApp = applications[0];
        const firstName = firstApp.firstName || 'User';
        const lastName = firstApp.lastName || '';
        const fullName = `${firstName} ${lastName}`.trim();
        
        document.getElementById('userName').textContent = firstName;
        document.getElementById('userFullName').textContent = fullName;
        document.getElementById('userEmail').textContent = userEmail;
        
        // Create avatar initials
        const initials = `${firstName.charAt(0)}${lastName.charAt(0)}`.toUpperCase();
        document.getElementById('userAvatar').textContent = initials;
        
        // Update settings form
        document.getElementById('settingsFirstName').value = firstName;
        document.getElementById('settingsLastName').value = lastName;
        document.getElementById('settingsEmail').value = userEmail;
        document.getElementById('settingsPhone').value = firstApp.phone || '';
    }
    
    loadApplications();
}

// Load applications function
function loadApplications() {
    const applications = JSON.parse(localStorage.getItem('loanApplications') || '[]');
    const applicationsList = document.getElementById('applicationsList');
    
    // Update summary cards
const totalApps = applications.length;
const approvedApps = applications.filter(app => {
    // Check if application has reached 100% progress or is marked as Approved
    const savedProgress = localStorage.getItem(`progress_${app.referenceNumber}`);
    return app.status === 'Approved' || savedProgress === '100';
});
const pendingApps = applications.filter(app => app.status === 'Pending' || app.status === 'Processing');

document.getElementById('totalApplications').textContent = totalApps;
document.getElementById('approvedApplications').textContent = approvedApps.length;
document.getElementById('pendingApplications').textContent = pendingApps.length;
    
    if (totalApps > 0) {
        const approvalRate = Math.round((approvedApps.length / totalApps) * 100);
        document.getElementById('approvalRate').textContent = approvalRate;
    }
    
    if (applications.length === 0) {
        applicationsList.innerHTML = `
            <div class="no-applications">
                <i class="fas fa-file-alt"></i>
                <p>No loan applications found.</p>
                <a href="apply.html" class="action-btn btn-apply">
                    <i class="fas fa-plus"></i> Apply for a Loan
                </a>
            </div>
        `;
        return;
    }
    
    let html = '';
    applications.forEach(app => {
        const amount = parseInt(app.loanAmount) || 0;
        const statusClass = getStatusClass(app.status);
        
        html += `
            <div class="application-card">
                <div class="application-header">
                    <div class="application-title">${app.loanType} Loan</div>
                    <div class="application-status ${statusClass}">${app.status}</div>
                </div>
                <div class="application-details">
                    <div class="detail-item">
                        <div class="detail-label">Reference Number</div>
                        <div class="detail-value">${app.referenceNumber}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Amount</div>
                        <div class="detail-value">R${amount.toLocaleString()}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Purpose</div>
                        <div class="detail-value">${app.loanPurpose}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Term</div>
                        <div class="detail-value">${app.loanTerm} months</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Application Date</div>
                        <div class="detail-value">${formatDate(new Date(app.applicationDate))}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Monthly Income</div>
                        <div class="detail-value">R${parseInt(app.monthlyIncome || 0).toLocaleString()}</div>
                    </div>
                </div>
                <div class="application-actions">
                    <button class="application-btn btn-view" onclick="viewApplication('${app.referenceNumber}')">
                        <i class="fas fa-eye"></i> View Details
                    </button>
                    ${app.status === 'Approved' ? 
                        `<button class="application-btn btn-track" onclick="viewApprovalLetter('${app.referenceNumber}')">
                            <i class="fas fa-file-pdf"></i> View Letter
                        </button>` : 
                        `<button class="application-btn btn-track" onclick="trackApplication('${app.referenceNumber}')">
                            <i class="fas fa-search"></i> Track
                        </button>`
                    }
                </div>
            </div>
        `;
    });
    
    applicationsList.innerHTML = html;
    
    // Load other sections
    loadActiveLoans(approvedApps);
    populatePaymentLoanDropdown(approvedApps);
    loadDocuments(applications);
    loadPayments();
}

// Helper functions
function getStatusClass(status) {
    switch(status) {
        case 'Approved': return 'status-approved';
        case 'Pending': return 'status-pending';
        case 'Processing': return 'status-processing';
        case 'Rejected': return 'status-rejected';
        default: return 'status-pending';
    }
}

function formatDate(date) {
    return date.toLocaleDateString('en-ZA', {
        year: 'numeric',
        month: 'short',
        day: 'numeric'
    });
}

function determineApplicationStatus(result) {
    // Simple logic to determine status based on creation date
    const createdDate = new Date(result.created_on);
    const now = new Date();
    const minutesPassed = Math.floor((now - createdDate) / (1000 * 60));
    
    if (minutesPassed >= 10) {
        return 'Approved';
    } else if (minutesPassed >= 1) {
        return 'Processing';
    } else {
        return 'Pending';
    }
}

function getInterestRate(loanType) {
    switch(loanType) {
        case 'Personal': return 3;
        case 'Business': return 4;
        case 'Vehicle': return 2.5;
        case 'Home': return 2;
        default: return 3;
    }
}

function calculateMonthlyPayment(amount, rate, term) {
    const monthlyRate = rate / 100 / 12;
    const payment = (amount * monthlyRate * Math.pow(1 + monthlyRate, term)) / 
                   (Math.pow(1 + monthlyRate, term) - 1);
    return Math.round(payment);
}

function updateApplicationStatus(referenceNumber, status) {
    const applications = JSON.parse(localStorage.getItem('loanApplications') || '[]');
    const appIndex = applications.findIndex(app => app.referenceNumber === referenceNumber);
    
    if (appIndex !== -1) {
        applications[appIndex].status = status;
        localStorage.setItem('loanApplications', JSON.stringify(applications));
        loadApplications();
    }
}

// Real application tracking with actual timing and advanced progress bar
function startRealApplicationTracking(application) {
    const progressBar = document.getElementById('trackingProgressBar');
    const progressPercentage = document.getElementById('progressPercentage');
    const steps = document.querySelectorAll('.tracking-step');
    const trackingMessage = document.getElementById('trackingMessage');
    const trackingActions = document.getElementById('trackingActions');
    
    // Check if we have a saved progress state that's less than 30 days old
    const savedProgress = localStorage.getItem(`progress_${application.referenceNumber}`);
    const savedProgressDate = localStorage.getItem(`progress_date_${application.referenceNumber}`);
    
    if (savedProgress && savedProgressDate) {
        const progressDate = new Date(savedProgressDate);
        const now = new Date();
        const daysDiff = (now - progressDate) / (1000 * 60 * 60 * 24);
        
        // If progress is saved and less than 30 days old, use it
        if (daysDiff < 30 && savedProgress === '100') {
            // Show 100% progress (fully approved) with animation
            animateProgressBar(100);
            steps.forEach(step => step.classList.add('completed'));
            
            trackingMessage.innerHTML = `
                <strong>Congratulations!</strong> Your loan application has been <strong>APPROVED</strong>.<br>
                <strong>Flagged for Low Credit Issue</strong><br>
                A credit improvement and cover will be needed.<br>
                <small style="color: #e74c3c; font-weight: bold;">Do not worry, we have the solution for you!</small><br><br>
                <strong>Your approval letter is ready!</strong>
            `;
            
            trackingActions.style.display = 'block';
            updateApplicationStatus(application.referenceNumber, 'Approved');
            return;
        }
    }
    
    const createdDate = new Date(application.applicationDate);
    const now = new Date();
    const timeDiff = now - createdDate;
    const minutesPassed = Math.floor(timeDiff / (1000 * 60));
    
    // Reset tracking
    steps.forEach(step => step.classList.remove('active', 'completed'));
    trackingActions.style.display = 'none';
    
    if (minutesPassed < 1) {
        // Initial state: 30% - Application submitted and processing
        animateProgressBar(30);
        steps[0].classList.add('active');
        trackingMessage.innerHTML = `Your application has been submitted and is now being processed. We'll update you shortly.`;
        
        // Save progress state
        localStorage.setItem(`progress_${application.referenceNumber}`, '30');
        localStorage.setItem(`progress_date_${application.referenceNumber}`, now.toISOString());
        
        // Set timer for next update
        setTimeout(() => {
            checkTrackingProgress(application);
        }, (1 - minutesPassed) * 60000); // Wait until 1 minute mark
        
    } else if (minutesPassed < 5) {
        // 1-5 minutes: 75% - Qualified
        animateProgressBar(75);
        steps[0].classList.add('completed');
        steps[1].classList.add('completed');
        steps[2].classList.add('active');
        
        const firstName = application.firstName || 'Applicant';
        const amount = parseInt(application.loanAmount).toLocaleString();
        trackingMessage.innerHTML = `<strong>Congratulations ${firstName}!</strong> You have qualified for the R${amount} loan application. We are processing for approval and payout.`;
        
        // Save progress state
        localStorage.setItem(`progress_${application.referenceNumber}`, '75');
        localStorage.setItem(`progress_date_${application.referenceNumber}`, now.toISOString());
        
        // Set timer for next update
        setTimeout(() => {
            checkTrackingProgress(application);
        }, (5 - minutesPassed) * 60000); // Wait until 5 minute mark
        
    } else if (minutesPassed < 10) {
        // 5-10 minutes: 100% - Approved but flagged
        animateProgressBar(100);
        steps[0].classList.add('completed');
        steps[1].classList.add('completed');
        steps[2].classList.add('completed');
        steps[3].classList.add('completed');
        steps[4].classList.add('active');
        
        trackingMessage.innerHTML = `
            <strong>Congratulations!</strong> Your loan application has been <strong>APPROVED</strong>.<br>
            <strong>Flagged for Low Credit Issue</strong><br>
            A credit improvement and cover will be needed.<br>
            <small style="color: #e74c3c; font-weight: bold;">Do not worry, we have the solution for you!</small><br><br>
            <em>Generating your approval letter...</em>
        `;
        
        // Save progress state
        localStorage.setItem(`progress_${application.referenceNumber}`, '100');
        localStorage.setItem(`progress_date_${application.referenceNumber}`, now.toISOString());
        
        // Show approval letter button after 30 seconds
        setTimeout(() => {
            trackingActions.style.display = 'block';
            trackingMessage.innerHTML = `
                <strong>Congratulations!</strong> Your loan application has been <strong>APPROVED</strong>.<br>
                <strong>Flagged for Low Credit Issue</strong><br>
                A credit improvement and cover will be needed.<br>
                <small style="color: #e74c3c; font-weight: bold;">Do not worry, we have the solution for you!</small><br><br>
                <strong>Your approval letter is ready!</strong>
            `;
            
            // Update application status
            updateApplicationStatus(application.referenceNumber, 'Approved');
        }, 30000); // 30 seconds for letter generation
        
    } else {
        // 10+ minutes: Fully approved
        animateProgressBar(100);
        steps.forEach(step => step.classList.add('completed'));
        
        trackingMessage.innerHTML = `
            <strong>Congratulations!</strong> Your loan application has been <strong>APPROVED</strong>.<br>
            <strong>Flagged for Low Credit Issue</strong><br>
            A credit improvement and cover will be needed.<br>
            <small style="color: #e74c3c; font-weight: bold;">Do not worry, we have the solution for you!</small><br><br>
            <strong>Your approval letter is ready!</strong>
        `;
        
        trackingActions.style.display = 'block';
        updateApplicationStatus(application.referenceNumber, 'Approved');
        
        // Save progress state
        localStorage.setItem(`progress_${application.referenceNumber}`, '100');
        localStorage.setItem(`progress_date_${application.referenceNumber}`, now.toISOString());
    }
}

// Animate progress bar with counting
function animateProgressBar(targetPercentage) {
    const progressBar = document.getElementById('trackingProgressBar');
    const progressPercentage = document.getElementById('progressPercentage');
    
    // Get current width
    const currentWidth = parseInt(progressBar.style.width || '0');
    const duration = 1500; // Animation duration in ms
    const frameRate = 30; // Frames per second
    const totalFrames = duration / (1000 / frameRate);
    const increment = (targetPercentage - currentWidth) / totalFrames;
    
    let currentFrame = 0;
    let currentPercentage = currentWidth;
    
    // Update progress percentage position
    progressPercentage.style.right = (100 - targetPercentage) + '%';
    
    const animationInterval = setInterval(() => {
        currentFrame++;
        currentPercentage += increment;
        
        if (currentFrame >= totalFrames) {
            clearInterval(animationInterval);
            currentPercentage = targetPercentage;
        }
        
        progressBar.style.width = currentPercentage + '%';
        progressPercentage.textContent = Math.round(currentPercentage) + '%';
        
        if (currentFrame >= totalFrames) {
            // Animation complete
            if (targetPercentage >= 100) {
                progressPercentage.style.background = '#27ae60';
            }
        }
    }, 1000 / frameRate);
}

// Check tracking progress and update accordingly
function checkTrackingProgress(application) {
    const createdDate = new Date(application.applicationDate);
    const now = new Date();
    const timeDiff = now - createdDate;
    const minutesPassed = Math.floor(timeDiff / (1000 * 60));
    
    if (minutesPassed >= 1 && minutesPassed < 5) {
        // Update to 75% - Qualified
        const steps = document.querySelectorAll('.tracking-step');
        const trackingMessage = document.getElementById('trackingMessage');
        
        animateProgressBar(75);
        steps[0].classList.add('completed');
        steps[1].classList.add('completed');
        steps[2].classList.add('active');
        
        const firstName = application.firstName || 'Applicant';
        const amount = parseInt(application.loanAmount).toLocaleString();
        trackingMessage.innerHTML = `<strong>Congratulations ${firstName}!</strong> You have qualified for the R${amount} loan application. We are processing for approval and payout.`;
        
        // Save progress state
        localStorage.setItem(`progress_${application.referenceNumber}`, '75');
        localStorage.setItem(`progress_date_${application.referenceNumber}`, now.toISOString());
        
        // Set timer for next update
        setTimeout(() => {
            checkTrackingProgress(application);
        }, (5 - minutesPassed) * 60000);
        
    } else if (minutesPassed >= 5) {
        // Update to 100% - Approved
        startRealApplicationTracking(application); // Re-run to show final state
    }
}

// Improve the fetchUserApplicationsFromBaserow function to get all user data
async function fetchUserApplicationsFromBaserow(email) {
    try {
        const response = await fetch(`${BASEROW_API_URL}${BASEROW_TABLE_ID}/?user_field_names=true`, {
            method: 'GET',
            headers: {
                'Authorization': `Token ${BASEROW_API_KEY}`
            }
        });
        
        if (!response.ok) {
            throw new Error(`API Error: ${response.status}`);
        }
        
        const data = await response.json();
        
        // Filter results by email
        const userRecords = data.results.filter(result => 
            result.Email && result.Email.toLowerCase().trim() === email.toLowerCase().trim()
        );
        
        if (userRecords.length === 0) {
            return;
        }
        
        // Process and store applications with all Baserow fields
        const applications = userRecords.map(result => {
            return {
                id: result.id,
                referenceNumber: `OPF-${String(result.id).padStart(5, '0')}`,
                loanType: result.loanType || 'Personal',
                loanAmount: result.loanAmount || 0,
                loanPurpose: result.loanPurpose || 'General',
                loanTerm: result.loanTearm || 12, // Note: Field name in Baserow is "loanTearm"
                firstName: result.name || '',
                lastName: result.lastname || '',
                idNumber: result.idNo || '',
                email: result.Email || email,
                phone: result.Phonenumber || '',
                employmentStatus: result.employ || 'Employed',
                monthlyIncome: result.income || 0,
                applicationDate: result.created_on || new Date().toISOString(),
                status: determineApplicationStatus(result),
                baserowId: result.id
            };
        });
        
        localStorage.setItem('loanApplications', JSON.stringify(applications));
        loadApplications();
        
    } catch (error) {
        console.error('Error fetching applications from Baserow:', error);
        loadApplications(); // Load from local storage as fallback
    }
}

// Add function to load active loans
function loadActiveLoans(approvedLoans) {
    const activeLoanslist = document.getElementById('activeLoanslist');
    const noLoansMessage = document.getElementById('noLoansMessage');
    
    if (!approvedLoans || approvedLoans.length === 0) {
        // No active loans
        document.getElementById('totalLoanAmount').textContent = 'R0';
        document.getElementById('monthlyPayment').textContent = 'R0';
        document.getElementById('outstandingBalance').textContent = 'R0';
        document.getElementById('activeLoanCount').textContent = '0';
        document.getElementById('nextPaymentDate').textContent = 'N/A';
        document.getElementById('paidOffPercentage').innerHTML = '<i class="fas fa-arrow-down"></i> 0% paid off';
        
        noLoansMessage.style.display = 'block';
        return;
    }
    
    // Hide no loans message
    noLoansMessage.style.display = 'none';
    
    // Calculate totals
    let totalAmount = 0;
    let totalMonthlyPayment = 0;
    let totalOutstanding = 0;
    
    approvedLoans.forEach(loan => {
        const amount = parseInt(loan.loanAmount) || 0;
        const interestRate = getInterestRate(loan.loanType);
        const term = parseInt(loan.loanTerm) || 12;
        
        totalAmount += amount;
        
        const monthlyPayment = calculateMonthlyPayment(amount, interestRate, term);
        totalMonthlyPayment += monthlyPayment;
        
        // Assume 10% paid off for demonstration
        const outstanding = amount * 0.9;
        totalOutstanding += outstanding;
    });
    
    // Update summary cards
    document.getElementById('totalLoanAmount').textContent = `R${totalAmount.toLocaleString()}`;
    document.getElementById('monthlyPayment').textContent = `R${totalMonthlyPayment.toLocaleString()}`;
    document.getElementById('outstandingBalance').textContent = `R${Math.round(totalOutstanding).toLocaleString()}`;
    document.getElementById('activeLoanCount').textContent = approvedLoans.length;
    
    // Calculate next payment date (15th of next month)
    const nextPayment = new Date();
    nextPayment.setMonth(nextPayment.getMonth() + 1);
    nextPayment.setDate(15);
    document.getElementById('nextPaymentDate').textContent = formatDate(nextPayment);
    
    // Calculate paid off percentage
    const paidOffPercentage = Math.round(((totalAmount - totalOutstanding) / totalAmount) * 100);
    document.getElementById('paidOffPercentage').innerHTML = `<i class="fas fa-arrow-down"></i> ${paidOffPercentage}% paid off`;
    
    // Generate active loans HTML
    let html = '';
    approvedLoans.forEach(loan => {
        const amount = parseInt(loan.loanAmount) || 0;
        const interestRate = getInterestRate(loan.loanType);
        const term = parseInt(loan.loanTerm) || 12;
        const monthlyPayment = calculateMonthlyPayment(amount, interestRate, term);
        const outstanding = amount * 0.9; // Assume 10% paid off
        
        html += `
            <div class="application-card">
                <div class="application-header">
                    <div class="application-title">${loan.loanType} Loan</div>
                    <div class="application-status status-approved">Active</div>
                </div>
                <div class="application-details">
                    <div class="detail-item">
                        <div class="detail-label">Reference Number</div>
                        <div class="detail-value">${loan.referenceNumber}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Loan Amount</div>
                        <div class="detail-value">R${amount.toLocaleString()}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Monthly Payment</div>
                        <div class="detail-value">R${monthlyPayment.toLocaleString()}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Outstanding Balance</div>
                        <div class="detail-value">R${Math.round(outstanding).toLocaleString()}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Interest Rate</div>
                        <div class="detail-value">${interestRate}% p.a.</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Loan Term</div>
                        <div class="detail-value">${term} months</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Next Payment</div>
                        <div class="detail-value">${formatDate(nextPayment)}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Status</div>
                        <div class="detail-value">In Good Standing</div>
                    </div>
                </div>
                <div class="application-actions">
                    <button class="application-btn btn-view" onclick="viewLoanDetails('${loan.referenceNumber}')">
                        <i class="fas fa-eye"></i> View Details
                    </button>
                    <button class="application-btn btn-track" onclick="viewApprovalLetter('${loan.referenceNumber}')">
                        <i class="fas fa-file-pdf"></i> View Approval Letter
                    </button>
                </div>
            </div>
        `;
    });
    
    activeLoanslist.innerHTML = html;
}

// Add function to populate payment loan dropdown
function populatePaymentLoanDropdown(approvedLoans) {
    const paymentLoanSelect = document.getElementById('paymentLoan');
    
    // Clear existing options
    paymentLoanSelect.innerHTML = '<option value="">Select loan</option>';
    
    if (!approvedLoans || approvedLoans.length === 0) {
        return;
    }
    
    // Add options for each approved loan
    approvedLoans.forEach(loan => {
        const option = document.createElement('option');
        option.value = loan.referenceNumber;
        option.textContent = `${loan.loanType} Loan (R${parseInt(loan.loanAmount).toLocaleString()})`;
        paymentLoanSelect.appendChild(option);
    });
}

// Add function to load documents
function loadDocuments(applications) {
    const documentsGrid = document.getElementById('documentsGrid');
    
    if (!applications || applications.length === 0) {
        documentsGrid.innerHTML = `
            <div class="no-applications" style="grid-column: 1 / -1;">
                <i class="fas fa-folder-open"></i>
                <p>No documents available yet.</p>
            </div>
        `;
        return;
    }
    
    let html = '';
    
    // Add approval letter for approved applications
    const approvedApps = applications.filter(app => app.status === 'Approved');
    approvedApps.forEach(app => {
        html += `
            <div class="document-card">
                <div class="document-icon">
                    <i class="fas fa-file-pdf"></i>
                </div>
                <h3 class="document-title">Loan Approval Letter</h3>
                <p class="document-date">Generated on ${formatDate(new Date())}</p>
                <div class="document-actions">
                    <button class="doc-btn btn-view-doc" onclick="window.location.href='approval.html'">
                        <i class="fas fa-eye"></i> View
                    </button>
                    <button class="doc-btn btn-download" onclick="window.location.href='approval.html'">
                        <i class="fas fa-download"></i> Download
                    </button>
                </div>
            </div>
        `;
    });
    
    // Add ID document for all applications
    applications.forEach(app => {
        html += `
            <div class="document-card">
                <div class="document-icon">
                    <i class="fas fa-id-card"></i>
                </div>
                <h3 class="document-title">ID Document</h3>
                <p class="document-date">Uploaded on ${formatDate(new Date(app.applicationDate))}</p>
                <div class="document-actions">
                    <button class="doc-btn btn-view-doc" onclick="viewDocument('id_${app.referenceNumber}')">
                        <i class="fas fa-check"></i> Uploaded Sucessful
                    </button>
                </div>
            </div>
        `;
        
        html += `
            <div class="document-card">
                <div class="document-icon">
                    <i class="fas fa-file-invoice-dollar"></i>
                </div>
                <h3 class="document-title">Bank Statement</h3>
                <p class="document-date">Uploaded on ${formatDate(new Date(app.applicationDate))}</p>
                <div class="document-actions">
                    <button class="doc-btn btn-view-doc" onclick="viewDocument('income_${app.referenceNumber}')">
                        <i class="fas fa-check"></i> Uploaded Sucessful
                    </button>
                </div>
            </div>
        `;
    });
    
    documentsGrid.innerHTML = html;
}

// Add function to load payments
function loadPayments() {
    const paymentsTableBody = document.getElementById('paymentsTableBody');
    const payments = JSON.parse(localStorage.getItem('payments') || '[]');
    
    if (payments.length === 0) {
        paymentsTableBody.innerHTML = `
            <tr class="no-payments-row">
                <td colspan="5" class="no-payments-message">No payment records found. Add your payment due dates above.</td>
            </tr>
        `;
        return;
    }
    
    let html = '';
    payments.forEach(payment => {
        const paymentDate = new Date(payment.date);
        const now = new Date();
        
        let status = 'pending';
        let statusText = 'Pending';
        
        if (paymentDate < now) {
            status = 'overdue';
            statusText = 'Overdue';
        } else if (payment.paid) {
            status = 'paid';
            statusText = 'Paid';
        }
        
        html += `
            <tr>
                <td>${formatDate(paymentDate)}</td>
                <td>${payment.loanType}</td>
                <td>R${parseInt(payment.amount).toLocaleString()}</td>
                <td><span class="payment-status payment-${status}">${statusText}</span></td>
                <td>
                    <button class="application-btn btn-view" onclick="markAsPaid('${payment.id}')">
                        <i class="fas fa-check"></i> Mark as Paid
                    </button>
                </td>
            </tr>
        `;
    });
    
    paymentsTableBody.innerHTML = html;
}

// Add payment form submission
document.getElementById('addPaymentForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const loanRef = document.getElementById('paymentLoan').value;
    const amount = document.getElementById('paymentAmount').value;
    const date = document.getElementById('paymentDate').value;
    
    if (!loanRef || !amount || !date) {
        alert('Please fill in all fields.');
        return;
    }
    
    // Get loan details
    const applications = JSON.parse(localStorage.getItem('loanApplications') || '[]');
    const loan = applications.find(app => app.referenceNumber === loanRef);
    
    if (!loan) {
        alert('Loan not found.');
        return;
    }
    
    // Create payment record
    const payment = {
        id: 'payment_' + Date.now(),
        loanRef: loanRef,
        loanType: loan.loanType,
        amount: amount,
        date: date,
        paid: false,
        createdAt: new Date().toISOString()
    };
    
    // Save payment
    const payments = JSON.parse(localStorage.getItem('payments') || '[]');
    payments.push(payment);
    localStorage.setItem('payments', JSON.stringify(payments));
    
    // Reset form
    this.reset();
    
    // Reload payments
    loadPayments();
});

// Add function to mark payment as paid
window.markAsPaid = function(paymentId) {
    const payments = JSON.parse(localStorage.getItem('payments') || '[]');
    const paymentIndex = payments.findIndex(p => p.id === paymentId);
    
    if (paymentIndex !== -1) {
        payments[paymentIndex].paid = true;
        localStorage.setItem('payments', JSON.stringify(payments));
        loadPayments();
    }
};

// Add function to view loan details
window.viewLoanDetails = function(referenceNumber) {
    alert(`Viewing details for loan: ${referenceNumber}`);
};

// Add function to view document
window.viewDocument = function(documentId) {
    alert(`This feature would display the document: ${documentId}`);
};

// Add function to download document
window.downloadDocument = function(documentId) {
    alert(`This feature would download the document: ${documentId}`);
};

// Add function to view application
window.viewApplication = function(referenceNumber) {
    alert(`Viewing application: ${referenceNumber}`);
};

// Add function to track application
window.trackApplication = function(referenceNumber) {
    alert(`Tracking application: ${referenceNumber}`);
};

// Modified function to view approval letter - now redirects to approval.html
window.viewApprovalLetter = function(referenceNumber) {
    // Redirect to approval.html
    window.location.href = 'approval.html';
};

// Close modal handlers
document.querySelectorAll('.close-modal, .close-modal-btn').forEach(btn => {
    btn.addEventListener('click', function() {
        document.getElementById('approvalLetterModal').style.display = 'none';
    });
});

// Close modal when clicking outside
window.addEventListener('click', function(event) {
    const modal = document.getElementById('approvalLetterModal');
    if (event.target === modal) {
        modal.style.display = 'none';
    }
});

// Dashboard navigation
document.querySelectorAll('[data-tab]').forEach(link => {
    link.addEventListener('click', function(e) {
        e.preventDefault();
        
        const targetTab = this.getAttribute('data-tab');
        
        // Remove active class from all menu items
        document.querySelectorAll('.dashboard-menu a').forEach(a => a.classList.remove('active'));
        
        // Add active class to clicked item
        if (this.classList.contains('dashboard-menu')) {
            this.classList.add('active');
        } else {
            document.querySelector(`.dashboard-menu a[data-tab="${targetTab}"]`).classList.add('active');
        }
        
        // Hide all tabs
        document.querySelectorAll('.dashboard-tab').forEach(tab => tab.classList.remove('active'));
        
        // Show target tab
        document.getElementById(targetTab + 'Tab').classList.add('active');
    });
});

// Logout functionality
document.getElementById('logoutBtn').addEventListener('click', function() {
    if (confirm('Are you sure you want to logout?')) {
        localStorage.removeItem('isLoggedIn');
        localStorage.removeItem('lastLoginTime');
        location.reload();
    }
});

// Settings form submission
document.getElementById('settingsForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const firstName = document.getElementById('settingsFirstName').value;
    const lastName = document.getElementById('settingsLastName').value;
    const phone = document.getElementById('settingsPhone').value;
    const currentPin = document.getElementById('currentPin').value;
    const newPin = document.getElementById('newPin').value;
    const confirmNewPin = document.getElementById('confirmNewPin').value;
    
    const email = localStorage.getItem('userEmail');
    const savedPin = localStorage.getItem(`pin_${email}`);
    
    // Update name and phone
    const applications = JSON.parse(localStorage.getItem('loanApplications') || '[]');
    if (applications.length > 0) {
        applications.forEach(app => {
            app.firstName = firstName;
            app.lastName = lastName;
            app.phone = phone;
        });
        localStorage.setItem('loanApplications', JSON.stringify(applications));
    }
    
    // Update PIN if provided
    if (currentPin && newPin && confirmNewPin) {
        if (currentPin !== savedPin) {
            alert('Current PIN is incorrect.');
            return;
        }
        
        if (newPin !== confirmNewPin) {
            alert('New PINs do not match.');
            return;
        }
        
        if (newPin.length !== 4 || !/^\d+$/.test(newPin)) {
            alert('PIN must be exactly 4 digits.');
            return;
        }
        
        localStorage.setItem(`pin_${email}`, newPin);
    }
    
    // Show success message
    document.getElementById('settingsSuccessMessage').style.display = 'block';
    setTimeout(() => {
        document.getElementById('settingsSuccessMessage').style.display = 'none';
    }, 3000);
    
    // Update UI
    document.getElementById('userName').textContent = firstName;
    document.getElementById('userFullName').textContent = `${firstName} ${lastName}`.trim();
    
    // Create avatar initials
    const initials = `${firstName.charAt(0)}${lastName.charAt(0)}`.toUpperCase();
    document.getElementById('userAvatar').textContent = initials;
    
    // Clear PIN fields
    document.getElementById('currentPin').value = '';
    document.getElementById('newPin').value = '';
    document.getElementById('confirmNewPin').value = '';
});

// Download letter functionality
document.getElementById('downloadLetterBtn').addEventListener('click', function() {
    alert('This feature would download the approval letter as a PDF.');
});

document.getElementById('viewApprovalLetterBtn').addEventListener('click', function() {
    window.location.href = 'approval.html';
});
</script>
</body>
</html>
